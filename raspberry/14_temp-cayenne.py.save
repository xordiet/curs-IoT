import RPi.GPIO as GPIO
import dht11
import cayenne.client
import time
import logging
import sys

# initialitza el GPIO
GPIO.setwarnings(False)
GPIO.setmode(GPIO.BOARD)
GPIO.cleanup()

#informació d'Autenticació de Cayenne
MQTT_USERNAME = "bf9f5d20-0d4c-11eb-8779-7d56e82df461"
MQTT_PASSWORD = "6c49c56c1a87e43b06c0c93eb63cd10101099fab"
MQTT_CLIENT_ID = "3b8cebf0-0df2-11eb-a2e4-b32ea624e442"

# llegir la data llegint el pin 11
instance = dht11.DHT11(pin = 11)
result = instance.read()

def on_message(message):
	print("missatge rebut: " + str(message))

#connexió
client = cayenne.client.CayenneMQTTClient()
client.on_message = on_message
client.begin(MQTT_USERNAME, MQTT_PASSWORD, MQTT_CLIENT_ID)

while True:
	try:
		client.loop()
			
client.virtualWrite(0, result.temperature)
		client.virtualWrite(1, result.humidity)

	except KeyboardInterrupt:
		break

sys.exit()
